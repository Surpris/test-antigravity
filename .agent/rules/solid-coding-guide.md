---
trigger: always_on
---

# SOLID原則 遵守マニフェスト

あなたは、高品質で変更に強いソフトウェアを構築するために、以下のSOLID原則を遵守しなければなりません。
このガイドは、設計判断の補助ツールとして活用し、「読みやすさ」と「変更のしやすさ」を両立させることを目的とします。

## 1. SRP：単一責任の原則 (Single Responsibility Principle)

**「クラスやモジュールは、ただ1つの変更理由を持つべきである」:**

- **指針:** アクター（変更要求者）ごとに責務を分離してください。
- **具体例:** 料金計算において、「税金」「送料」「割引」のロジックを1つのメソッドに混ぜてはいけません。それぞれの計算ロジックを独立したクラスに切り出してください。
- **チェックリスト:**
  - そのクラスを変更する理由は2つ以上ありませんか？
  - 税制変更の影響が、送料計算ロジックに波及していませんか？

## 2. OCP：開放閉鎖の原則 (Open-Closed Principle)

**「拡張に対して開いており、修正に対して閉じているべきである」:**

- **指針:** 新機能を追加する際に、既存のコードを書き換えるのではなく、新しいコードを追加することで対応できるように設計してください。
- **具体例:** 新しい割引ルール（クーポンや会員ランク割引）を追加するたびに `if/else` を増やすのではなく、`Strategy` パターンを用いて、新しい割引クラスを作成し追加するだけで完了するようにします。
- **チェックリスト:**
  - 仕様変更のたびに、コアとなるロジック（計算フローなど）を編集していませんか？
  - 差し替え可能なインターフェースを利用していますか？

## 3. LSP：リスコフの置換原則 (Liskov Substitution Principle)

**「派生型はその基本型と置換可能でなければならない」:**

- **指針:** 抽象化されたインターフェースを実装する際、「契約（前提条件と事後条件）」を遵守してください。
- **具体例:** 「割引ポリシー」のインターフェースを実装する場合、その実装クラスが逆に「値上げ」をしてはいけません。親の期待する振る舞いを壊す実装は避けてください。
- **チェックリスト:**
  - 派生クラスで、親クラスにはない「想定外の例外」を投げていませんか？
  - 「差し替えたら動かなくなった」という事態は起きていませんか？

## 4. ISP：インターフェース分離の原則 (Interface Segregation Principle)

**「必要のないメソッドへの依存を強制してはならない」:**

- **指針:** 巨大なインターフェースを避け、利用側の目的に合わせた小さなインターフェースに分割してください。
- **具体例:** 「管理画面用の税率参照」と「チェックアウト用の全計算」が必要な場合、1つの巨大な `Calculator` インターフェースではなく、それぞれに必要なメソッドだけを持つ小さなインターフェース（または Python なら `Protocol`）に分けて依存させてください。
- **チェックリスト:**
  - クライアントが使わないメソッドを含むインターフェースに依存していませんか？

## 5. DIP：依存性逆転の原則 (Dependency Inversion Principle)

**「上位のモジュールは下位のモジュールに依存してはならない。両者は抽象に依存すべきである」:**

- **指針:** 具体的な実装（外部API、DB、ファイル操作）に直接依存せず、抽象（インターフェース、Protocol）を介してやり取りしてください。
- **具体例:** 料金計算クラスが `TaxRateAPI` を直接呼び出すのではなく、`TaxRateProvider` という抽象インターフェースに依存するようにします。
- **チェックリスト:**
  - 外部サービスやライブラリの仕様変更に、メインのビジネスロジックが引きずられていませんか？
  - そのロジックは、外部環境がなくてもユニットテストが可能ですか？

---

## ⚠️ 注意事項：やりすぎ厳禁

SOLID原則は「目的」ではなく「道具」です。以下の状態には注意してください：

- 将来の準備を優先しすぎて、コードが過剰に抽象化され読みにくくなっている。
- 軽微な変更に対して、クラスやインターフェースが過剰に増殖している。
- 「なぜ分けたか」を説明できず、原則を守ること自体が自己目的化している。

原則は常に、**「変更が起きる痛み（Why）」** に基づいて適用してください。
